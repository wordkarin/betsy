<article>
  <header>
    <h1 class="page-title">Here is all the information for a single merchant and links to what they do</h1>
  </header>
  <section>
    <%= "You are registed under the name: #{@merchant.name} (#{@merchant.email})" %>
    <%= "through the #{"PROVIDER"} authentication" %>
  </section>
  <section>
    <%= link_to "Add a new product", new_merchant_product_path(@merchant) %>
    <%= link_to "Add a new product category", new_category_path %>
    <p>

    </p>
  </section>
<% @merchant.products.each do |product| %>

  <% if product.orders.length > 0 %>
  <!-- For each product the merchant has, we're listing the product, and then inside each   product's section, we're listing each of the orders that contains that product. -->
    <table>
      <h3><%= link_to "#{product.name}", product_path(product) %>
        <small><%= link_to "Edit", edit_product_path(product) %></small>
        <small><%= link_to "" %></small>
      </h3>
      <!-- Update this to be revenue instead of product price. -->
      <p>THIS IS THE PRODUCT'S PRICE<%= product.price %></p>
      <tr>
        <th>Order Date</th>
        <th>Order Number</th>
        <th>Customer</th>
        <th>Order Status</th>
        <!-- <th>Order Revenue</th> -->
        <th>Order Details</th>
      </tr>
      <% product.orders.reverse.each do |order| %>
        <section>
          <tr>
            <td><%=order.purchase_time.strftime("%Y-%m-%d")%></td>
            <td><%=order.id%></td>
            <td><%=order.name%></td>
            <td><%=order.status%></td>
            <!-- <td><%= OrderItem.find_by(product_id = product.id, order_id = order.id)%></td>   -->
            <td><%= link_to "View", order_path(order) %></td>
          </tr>
        </section>
      <% end %>
    </table>
  <% else %>
    <h3><%= link_to "#{product.name}", product_path(product) %>
      <small><%= link_to "Edit", edit_product_path(product) %></small>
      <small><%= link_to "" %></small>
    </h3>
  <% end %>
<% end %>
</article>
